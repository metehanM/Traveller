<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Paneli</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background: #181A20; color: #fff; margin: 0; }
    .admin-container { max-width: 500px; margin: 80px auto; background: #23242b; border-radius: 18px; box-shadow: 0 4px 24px rgba(67,24,255,0.10); padding: 40px 32px; text-align: center; }
    h1 { color: #05CD99; margin-bottom: 18px; }
    .logout-btn { background: #ff4d4f; color: #fff; border: none; border-radius: 8px; padding: 10px 24px; font-size: 16px; cursor: pointer; margin-top: 32px; }
  </style>
</head>
<body>
  <div class="admin-container" id="admin-content" style="display:none;">
    <h1>Admin Paneli</h1>
    <p>Hoşgeldin <span id="admin-email"></span>!</p>
    <p>Burada sadece adminlerin görebileceği özel içerikler yer alacak.</p>
    <div id="user-list"></div>
    <button class="logout-btn" id="logout-btn">Çıkış Yap</button>
  </div>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCRArf2VPbZuvLueY2qm2Lz9GhQXLvhzxY",
      authDomain: "rentcars-1077b.firebaseapp.com",
      projectId: "rentcars-1077b",
      storageBucket: "rentcars-1077b.appspot.com",
      messagingSenderId: "564934399024",
      appId: "1:564934399024:web:11dcb72be4d44e2a1709f5",
      measurementId: "G-DMX2083TNQ"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    // Rol hiyerarşisi
    const ROLES = ['owner', 'admin-orta', 'admin-alt'];
    const ROLE_LABELS = { 'owner': 'Owner', 'admin-orta': 'Orta Düzey', 'admin-alt': 'Alt Düzey' };
    // Sadece adminler erişebilsin
    auth.onAuthStateChanged(async user => {
      if (!user) return window.location.href = 'login.html';
      // Kullanıcı Firestore'da admin mi kontrol et
      const userDoc = await db.collection('users').doc(user.uid).get();
      let myRole = 'admin-alt';
      if (user.email === 'mthnrsy@gmail.com') myRole = 'owner';
      else if (userDoc.exists && userDoc.data().role) myRole = userDoc.data().role;
      if (!ROLES.includes(myRole)) return window.location.href = 'login.html';
      document.getElementById('admin-content').style.display = 'block';
      document.getElementById('admin-email').textContent = user.email + ' (' + ROLE_LABELS[myRole] + ')';
      // Tüm kullanıcıları listele
      const usersSnap = await db.collection('users').get();
      const userListDiv = document.getElementById('user-list');
      userListDiv.innerHTML = '<h3>Kullanıcılar</h3>' +
        Array.from(usersSnap.docs).map(doc => {
          const d = doc.data();
          const uid = doc.id;
          let role = d.role || '';
          let roleLabel = ROLE_LABELS[role] || (d.email === 'mthnrsy@gmail.com' ? 'Owner' : 'Kullanıcı');
          let adminBadge = role ? `<b style='color:#05CD99'>(${roleLabel})</b>` : '';
          let buttons = '';
          // Owner her role atayabilir
          if (myRole === 'owner' && d.email !== user.email) {
            buttons = ROLES.map(r => r !== role ? `<button onclick="setRole('${uid}','${r}')" style="background:#05CD99;color:#fff;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;margin-left:4px;">${ROLE_LABELS[r]}</button>` : '').join('');
          }
          // Orta düzey sadece admin-alt atayabilir
          else if (myRole === 'admin-orta' && d.email !== user.email && role !== 'owner') {
            if (role !== 'admin-alt') {
              buttons = `<button onclick="setRole('${uid}','admin-alt')" style="background:#05CD99;color:#fff;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;">Alt Düzey Yap</button>`;
            }
          }
          // Alt düzey sadece liste görebilir
          return `<div style="display:flex;align-items:center;justify-content:space-between;margin:8px 0;padding:8px 0;border-bottom:1px solid #333;">
            <span>${d.email} ${adminBadge}</span>
            <span>${buttons}</span>
          </div>`;
        }).join('');
    });
    window.setRole = async function(uid, role) {
      await db.collection('users').doc(uid).set({ role }, { merge: true });
      location.reload();
    };
    document.getElementById('logout-btn').onclick = function() {
      auth.signOut().then(() => window.location.href = 'login.html');
    };
  </script>
</body>
</html> 